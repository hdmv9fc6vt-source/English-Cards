<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no,email=no,address=no">
    <title>è‹±è¯­å­¦ä¹ å¡ç‰‡ï¼ˆæœ€ç»ˆç‰ˆï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background: #FFFFFF;
            padding: 16px;
            line-height: 1.7;
            padding-bottom: 100px;
            -webkit-overflow-scrolling: touch;
            min-height: 100vh;
        }
        /* é¡¶éƒ¨æœç´¢+æ ‡é¢˜ */
        .header-wrap {
            margin-bottom: 24px;
            gap: 16px;
            display: flex;
            flex-direction: column;
            background: #FFFFFF;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid #E8F5E8;
        }
        .top-title {
            font-size: 28px;
            font-weight: 700;
            color: #2d3748;
            text-align: center;
            letter-spacing: 1px;
            background: linear-gradient(135deg, #A8D08D 0%, #C8E6C9 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .search-box {
            width: 100%;
            position: relative;
            height: 56px;
        }
        .search-input {
            width: 100%;
            height: 100%;
            padding: 0 20px 0 50px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 28px;
            font-size: 16px;
            background: #ffffff;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
        }
        .search-input:focus {
            outline: none;
            border-color: #A8D08D;
            box-shadow: 0 0 0 4px rgba(168, 208, 141, 0.1), 0 6px 24px rgba(168, 208, 141, 0.15);
        }
        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: #A8D08D;
            font-size: 22px;
        }
        .search-tips {
            font-size: 12px;
            color: #718096;
            text-align: center;
            line-height: 1.4;
            background: rgba(102, 126, 234, 0.05);
            padding: 8px 16px;
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        /* æ ‡ç­¾ç­›é€‰åŒº */
        .filter-wrap {
            background: #FFFFFF;
            padding: 20px 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid #E8F5E8;
        }
        .filter-title {
            font-size: 18px;
            color: #2d3748;
            margin-bottom: 16px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .tag-delete-tips {
            font-size: 12px;
            color: #f56565;
        }
        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 16px;
        }
        .tag-item {
            padding: 10px 20px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(102, 126, 234, 0.2);
            color: #4a5568;
            background: #f7fafc;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }
        .tag-item.system-tag .tag-del-btn {
            display: none;
        }
        .tag-item:hover {
            border-color: rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        .tag-item.active {
            background: linear-gradient(135deg, #A8D08D 0%, #C8E6C9 100%);
            color: #fff;
            border-color: transparent;
            box-shadow: 0 6px 20px rgba(168, 208, 141, 0.3);
            transform: translateY(-2px);
        }
        .tag-del-btn {
            font-size: 11px;
            color: #718096;
            cursor: pointer;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(102, 126, 234, 0.1);
            transition: all 0.2s ease;
        }
        .tag-del-btn:hover {
            background: #f56565;
            color: #fff;
            box-shadow: 0 2px 8px rgba(245, 101, 101, 0.3);
        }
        .custom-tag-wrap {
            margin-top: 0;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        .custom-tag-input {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 24px;
            font-size: 14px;
            background: #ffffff;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
        }
        .custom-tag-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        .custom-tag-btn {
            padding: 10px 22px;
            border-radius: 24px;
            border: none;
            background: linear-gradient(135deg, #A8D08D 0%, #C8E6C9 100%);
            color: #fff;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
            box-shadow: 0 4px 16px rgba(168, 208, 141, 0.2);
        }
        .custom-tag-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(168, 208, 141, 0.3);
        }
        .custom-tag-btn:active {
            background: linear-gradient(135deg, #90C981 0%, #AED5B4 100%);
            transform: translateY(0) scale(0.98);
            box-shadow: 0 2px 8px rgba(168, 208, 141, 0.2);
        }
        /* æ—¥æœŸåˆ†ç»„ */
        .date-group {
            margin-bottom: 12px;
        }
        .date-title {
            font-size: 19px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 12px;
            padding: 16px 20px;
            background: #FFFFFF;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #E8F5E8;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }
        .date-title::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.6s ease;
        }
        .date-title:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        .date-title:hover::before {
            left: 100%;
        }
        .date-title:active {
            transform: translateY(0) scale(0.98);
        }
        .date-icon {
            color: #667eea;
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
        }
        .date-card-count {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            padding: 4px 14px;
            border-radius: 16px;
            margin-left: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        .date-right-wrap {
            display: flex;
            align-items: center;
            margin-left: auto;
        }
        .date-toggle-icon {
            color: #667eea;
            font-size: 22px;
            font-weight: 700;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .date-cards-wrap {
            overflow: hidden;
            transition: height 0.3s ease;
            height: auto;
            padding-left: 8px;
        }
        /* å¡ç‰‡æ ¸å¿ƒæ ·å¼ - ä¿ç•™å·¦æ»‘äº¤äº’ */
        .card-container {
            position: relative;
            width: 100%;
            margin-bottom: 16px;
            overflow: hidden;
            border-radius: 24px;
            touch-action: pan-y;
            height: auto;
        }
        /* ä¿ç•™æŒ‰é’®ç»„å±‚çº§å’Œä½ç½® */
        .card-btn-group {
            position: absolute;
            top: 0;
            right: 0;
            width: 180px;
            height: 100%;
            display: flex;
            z-index: 1;
            background: transparent;
        }
        /* ä¿ç•™å¡ç‰‡æ ·å¼ï¼Œä¿®å¤æ»‘åŠ¨ä¸ç©¿é€ */
        .card {
            background: #FFFFFF;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
            border-radius: 12px;
            border-left: 4px solid transparent;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 2;
            position: relative;
            width: 100%;
            height: 100%;
            border: 1px solid #E8F5E8;
        }
        .card:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            transform: translateY(-3px);
        }
        .card:active {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            transform: translateY(-1px);
        }
        .card.selected {
            box-shadow: 0 12px 40px rgba(156, 175, 136, 0.3);
            border: 2px solid rgba(156, 175, 136, 0.5);
        }
        .card.collect {
            border-left: 4px solid #fbbf24;
            background: rgba(255, 251, 235, 0.95);
        }
        /* å¡ç‰‡æ ‡é¢˜ - ä¿ç•™æŠ˜å äº¤äº’ */
        .card-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: #F2F8F1;
            color: #333333;
            border-radius: 12px;
            line-height: 1.5;
            letter-spacing: 0.5px;
            cursor: pointer;
            gap: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #E8F5E8;
        }
        .card-title-left {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
        }
        .collect-btn {
            font-size: 24px;
            cursor: pointer;
            color: rgba(102, 102, 102, 0.6);
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .collect-btn:hover {
            transform: scale(1.2);
        }
        .card.collect .collect-btn {
            color: #fbbf24;
            animation: pulse 0.3s ease;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1.2); }
        }
        .card-title-text {
            flex: 1;
        }
        .card-title-toggle {
            color: #666666;
            font-size: 24px;
            font-weight: 700;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        /* å¡ç‰‡å†…å®¹ - ä¿®å¤å±•å¼€æ˜¾ç¤ºä¸å…¨ï¼Œä¿ç•™åŸæœ‰æ ·å¼ */
        .card-content-wrap {
            padding: 24px;
            transition: all 0.3s ease;
            max-height: 2000px;
            overflow: hidden;
            opacity: 1;
            background: #FFFFFF;
            border-radius: 0 0 12px 12px;
        }
        .card-content-wrap.collapse {
            max-height: 0 !important;
            padding: 0 24px;
            opacity: 0;
        }
        /* ä¿ç•™ç¼–è¾‘/åˆ é™¤æŒ‰é’®æ ·å¼å’Œäº¤äº’ */
        .card-edit-btn {
            flex: 1;
            background: linear-gradient(135deg, #A8D08D 0%, #C8E6C9 100%);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            gap: 6px;
            transition: all 0.3s ease;
            border-radius: 0;
        }
        .card-edit-btn::before {
            content: "âœï¸";
            font-size: 18px;
        }
        .card-edit-btn:hover {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        }
        .card-edit-btn:active {
            background: linear-gradient(135deg, #2f855a 0%, #276749 100%);
            transform: scale(0.98);
        }
        .card-delete-btn {
            flex: 1;
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            gap: 6px;
            transition: all 0.3s ease;
            border-radius: 0;
        }
        .card-delete-btn::before {
            content: "ğŸ—‘ï¸";
            font-size: 18px;
        }
        .card-delete-btn:hover {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }
        .card-delete-btn:active {
            background: linear-gradient(135deg, #c53030 0%, #9b2c2c 100%);
            transform: scale(0.98);
        }
        /* ä¿ç•™æ ‡é¢˜åŒ¹é…æ ·å¼ - æé«˜ä¼˜å…ˆçº§ */
        .card-content {
            font-size: 15px;
            color: #4a5568;
            line-height: 1.6;
            -webkit-user-select: text;
            user-select: text;
        }
        .card-title-text {
            -webkit-user-select: text;
            user-select: text;
        }
        .card-tag {
            -webkit-user-select: text;
            user-select: text;
        }
        .card-content b {
            color: #2d3748;
            font-weight: 600;
        }
        /* ä¿ç•™æ ‡é¢˜åŒ¹é…å­—æ®µæ ·å¼ - æœ€é«˜ä¼˜å…ˆçº§ */
        .card-content .title-match {
            color: #dc2626 !important;
            font-weight: 700 !important;
            text-shadow: 0 0 2px rgba(220, 38, 38, 0.1) !important;
            background: rgba(220, 38, 38, 0.05);
            padding: 2px 6px;
            border-radius: 4px;
        }
        .card-content p {
            margin-bottom: 16px;
        }
        .card-content p:last-child {
            margin-bottom: 0;
        }
        .card-content blockquote {
            margin: 16px 0;
            padding: 12px 20px;
            border-left: 4px solid #A8D08D;
            background: #f5f5f5;
            border-radius: 0 8px 8px 0;
            color: #4a5568;
            font-style: italic;
            line-height: 1.5;
        }
        .card-content ul,
        .card-content ol {
            margin: 16px 0;
            padding-left: 24px;
        }
        .card-content li {
            margin-bottom: 6px;
            line-height: 1.5;
            color: #4a5568;
        }
        .card-content li:last-child {
            margin-bottom: 0;
        }
        .card-content ul li {
            list-style-type: disc;
        }
        .card-content ol li {
            list-style-type: decimal;
        }
        .card-tag {
            font-size: 14px;
            padding: 6px 16px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            color: #667eea;
            display: inline-block;
            margin-top: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        /* ä¿ç•™å¯Œæ–‡æœ¬æŒ‰é’® */
        .format-btn-group {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .format-btn {
            padding: 10px 16px;
            border-radius: 16px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
        }
        .format-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        .format-btn:active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border-color: transparent;
            transform: translateY(0) scale(0.96);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        /* ä¿ç•™åº•éƒ¨æ–°å¢æŒ‰é’® */
        .add-card-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9CAF88 0%, #A8B5C4 100%);
            color: white;
            font-size: 36px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(156, 175, 136, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 999;
            -webkit-appearance: none;
            appearance: none;
        }
        .add-card-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 40px rgba(156, 175, 136, 0.5);
        }
        .add-card-btn:active {
            background: linear-gradient(135deg, #8A9A78 0%, #98A5B4 100%);
            transform: scale(0.98) rotate(90deg);
        }
        /* æ—¥å†æŒ‰é’® */
        .calendar-btn {
            position: fixed;
            bottom: 30px;
            right: 120px;
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: linear-gradient(135deg, #A8D08D 0%, #C8E6C9 100%);
            color: white;
            font-size: 36px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(168, 208, 141, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 999;
            -webkit-appearance: none;
            appearance: none;
        }
        .calendar-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 40px rgba(168, 208, 141, 0.5);
        }
        .calendar-btn:active {
            background: linear-gradient(135deg, #8A9A78 0%, #98A5B4 100%);
            transform: scale(0.98);
        }
        /* ä¿ç•™å¼¹çª—æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            -webkit-overflow-scrolling: touch;
            backdrop-filter: blur(8px);
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            width: 92%;
            max-width: 520px;
            border-radius: 28px;
            padding: 32px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            transform: translateY(20px);
            opacity: 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .modal.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 28px;
            text-align: center;
            letter-spacing: 0.5px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .form-item {
            margin-bottom: 24px;
        }
        .form-label {
            font-size: 16px;
            color: #2d3748;
            margin-bottom: 10px;
            display: block;
            font-weight: 600;
        }
        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 20px;
            font-size: 16px;
            resize: none;
            background: #ffffff;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            background: #fff;
        }
        .form-textarea {
            min-height: 160px;
            line-height: 1.7;
        }
        .form-tips {
            font-size: 13px;
            color: #718096;
            margin-top: 8px;
            line-height: 1.4;
        }
        .modal-btn-group {
            display: flex;
            gap: 16px;
            margin-top: 32px;
        }
        .modal-btn {
            flex: 1;
            padding: 16px 0;
            border-radius: 20px;
            border: 2px solid transparent;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
        }
        .cancel-btn {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border-color: rgba(102, 126, 234, 0.2);
        }
        .cancel-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        .cancel-btn:active {
            background: rgba(102, 126, 234, 0.3);
            transform: translateY(0) scale(0.98);
        }
        .confirm-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
        }
        .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        .confirm-btn:active {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a408f 100%);
            transform: translateY(0) scale(0.98);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        /* å…¨é¢å“åº”å¼è®¾è®¡ */
        /* å°å±æ‰‹æœºï¼ˆiPhone SEã€å°å±Androidï¼‰ */
        @media (max-width: 375px) {
            .header-wrap {
                padding: 16px;
                gap: 12px;
            }
            .top-title {
                font-size: 24px;
            }
            .search-box {
                height: 50px;
            }
            .search-input {
                padding: 0 18px 0 46px;
            }
            .filter-wrap {
                padding: 16px 20px;
            }
            .filter-title {
                font-size: 16px;
            }
            .tag-item {
                padding: 8px 16px;
                font-size: 13px;
            }
            .custom-tag-btn {
                padding: 8px 18px;
            }
            .date-title {
                font-size: 17px;
                padding: 16px 20px;
                margin-bottom: 10px;
                gap: 12px;
            }
            .date-icon {
                font-size: 20px;
                width: 36px;
                height: 36px;
            }
            .date-card-count {
                font-size: 13px;
                padding: 3px 12px;
            }
            .date-toggle-icon {
                font-size: 20px;
                width: 24px;
                height: 24px;
            }
            .date-group {
                margin-bottom: 12px;
            }
            .card-title {
                font-size: 17px;
                padding: 14px 18px;
            }
            .card-content {
                font-size: 15px;
                line-height: 1.6;
            }
            .card-content-wrap {
                padding: 20px;
            }
            .card-btn-group {
                width: 160px;
            }
            .card-edit-btn,.card-delete-btn {
                font-size: 15px;
                gap: 4px;
            }
            .card-edit-btn::before,
            .card-delete-btn::before {
                font-size: 16px;
            }
            .add-card-btn {
                width: 64px;
                height: 64px;
                font-size: 32px;
                bottom: 20px;
                right: 20px;
            }
            .calendar-btn {
                width: 64px;
                height: 64px;
                font-size: 32px;
                bottom: 20px;
                right: 100px;
            }
            .modal-content {
                padding: 28px;
            }
            .modal-title {
                font-size: 22px;
            }
            .form-input, .form-textarea, .form-select {
                padding: 14px 18px;
            }
            .modal-btn {
                padding: 14px 0;
            }
            /* å¿«æ·æ ¼å¼æŒ‰é’®é€‚é… */
            .format-btn {
                padding: 6px 12px;
                font-size: 13px;
            }
            .format-btns {
                gap: 8px;
            }
        }
        
        /* ä¸­å±æ‰‹æœºï¼ˆiPhone 8ã€å¤§éƒ¨åˆ†Androidæ‰‹æœºï¼‰ */
        @media (min-width: 376px) and (max-width: 480px) {
            .header-wrap {
                padding: 20px;
                gap: 14px;
            }
            .top-title {
                font-size: 26px;
            }
            .filter-wrap {
                padding: 18px 22px;
            }
            .card-title {
                font-size: 18px;
                padding: 16px 20px;
            }
            .card-content-wrap {
                padding: 22px;
            }
            .add-card-btn {
                width: 68px;
                height: 68px;
                bottom: 25px;
                right: 25px;
            }
            .calendar-btn {
                width: 68px;
                height: 68px;
                bottom: 25px;
                right: 115px;
            }
        }
        
        /* å¤§å±æ‰‹æœºï¼ˆiPhone Plusç³»åˆ—ã€å¤§å±Androidæ‰‹æœºï¼‰ */
        @media (min-width: 481px) and (max-width: 767px) {
            .header-wrap {
                padding: 24px;
                gap: 16px;
                max-width: 500px;
                margin: 0 auto 24px;
            }
            .filter-wrap {
                max-width: 500px;
                margin: 0 auto 24px;
            }
            .date-group {
                max-width: 500px;
                margin: 0 auto 24px;
            }
            .add-card-btn {
                width: 72px;
                height: 72px;
                bottom: 30px;
                right: 30px;
            }
            .calendar-btn {
                width: 72px;
                height: 72px;
                bottom: 30px;
                right: 120px;
            }
        }
        
        /* iPadç«–å± */
        @media (min-width: 768px) and (max-width: 1024px) {
            body {
                padding: 24px;
            }
            .header-wrap {
                max-width: 700px;
                margin: 0 auto 24px;
                padding: 28px;
            }
            .top-title {
                font-size: 32px;
            }
            .filter-wrap {
                max-width: 700px;
                margin: 0 auto 24px;
                padding: 20px 28px;
            }
            .date-group {
                max-width: 700px;
                margin: 0 auto 20px;
            }
            .date-title {
                padding: 20px 28px;
                font-size: 21px;
                margin-bottom: 14px;
            }
            .card-title {
                font-size: 19px;
                padding: 18px 24px;
            }
            .card-content-wrap {
                padding: 28px;
            }
            .card-content {
                font-size: 16px;
                line-height: 1.7;
            }
            .add-card-btn {
                width: 72px;
                height: 72px;
                font-size: 36px;
                bottom: 30px;
                right: 30px;
            }
            .calendar-btn {
                width: 72px;
                height: 72px;
                font-size: 36px;
                bottom: 30px;
                right: 120px;
            }
            .modal-content {
                max-width: 600px;
                padding: 36px;
            }
            .modal-title {
                font-size: 28px;
            }
            .form-input, .form-textarea, .form-select {
                padding: 18px 22px;
                font-size: 17px;
            }
            .modal-btn {
                padding: 18px 0;
                font-size: 17px;
            }
            /* å¿«æ·æ ¼å¼æŒ‰é’®é€‚é… */
            .format-btn {
                padding: 10px 20px;
                font-size: 15px;
            }
            .format-btns {
                gap: 12px;
            }
        }
        
        /* iPadæ¨ªå±åŠä»¥ä¸Š */
        @media (min-width: 1025px) {
            body {
                padding: 32px;
                max-width: 1200px;
                margin: 0 auto;
            }
            .header-wrap {
                max-width: 900px;
                margin: 0 auto 32px;
                padding: 32px;
            }
            .filter-wrap {
                max-width: 900px;
                margin: 0 auto 32px;
                padding: 24px 32px;
            }
            .date-group {
                max-width: 900px;
                margin: 0 auto 32px;
            }
            .date-title {
                padding: 24px 32px;
                font-size: 22px;
            }
            .card-title {
                font-size: 19px;
                padding: 18px 24px;
            }
            .card-content-wrap {
                padding: 32px;
            }
            .card-content {
                font-size: 18px;
                line-height: 1.8;
            }
            .add-card-btn {
                width: 80px;
                height: 80px;
                font-size: 40px;
                bottom: 40px;
                right: 40px;
            }
            .calendar-btn {
                width: 80px;
                height: 80px;
                font-size: 40px;
                bottom: 40px;
                right: 140px;
            }
            .modal-content {
                max-width: 700px;
                padding: 40px;
            }
            .modal-title {
                font-size: 32px;
            }
            .form-input, .form-textarea, .form-select {
                padding: 20px 24px;
                font-size: 18px;
            }
            .modal-btn {
                padding: 20px 0;
                font-size: 18px;
            }
        }
        /* ä¿ç•™åˆ˜æµ·å±/çµåŠ¨å²›é€‚é… */
        @supports (top: env(safe-area-inset-top)) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: calc(100px + env(safe-area-inset-bottom));
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
            }
            .add-card-btn {
                bottom: calc(30px + env(safe-area-inset-bottom));
                right: calc(30px + env(safe-area-inset-right));
            }
        }
    </style>
</head>
<body>
    <div class="header-wrap">
        <h1 class="top-title">Personal English Corpus</h1>
        <div class="search-box">
            <span class="search-icon">ğŸ”</span>
            <input type="text" class="search-input" id="globalSearch" placeholder="Search titles/content/favorites, precise matching" oninput="globalFullSearch()">
        </div>
        <p class="search-tips">Swipe left for edit/delete | Long press to look up dictionary | Title folding | Daily archiving | â˜† Favorite | Title matching automatically bold and red | Tags can be deleted</p>
    </div>

    <div class="filter-wrap">
        <div class="filter-title">
            å¡ç‰‡åˆ†ç±»ç­›é€‰
            <span class="tag-delete-tips">ï¼ˆè‡ªå®šä¹‰æ ‡ç­¾å¯ç‚¹å‡»Ã—åˆ é™¤ï¼‰</span>
        </div>
        <div class="tag-list" id="tagList">
            <div class="tag-item system-tag active" onclick="filterCard('all')">å…¨éƒ¨å¡ç‰‡</div>
            <div class="tag-item system-tag" onclick="filterCard('æ ¸å¿ƒè¯æ±‡')">æ ¸å¿ƒè¯æ±‡</div>
            <div class="tag-item system-tag" onclick="filterCard('åŸºç¡€å¥å‹')">åŸºç¡€å¥å‹</div>
            <div class="tag-item system-tag" onclick="filterCard('è¯­æ³•è€ƒç‚¹')">è¯­æ³•è€ƒç‚¹</div>
            <div class="tag-item system-tag" onclick="filterCard('å†™ä½œç´ æ')">å†™ä½œç´ æ</div>
        </div>
        <div class="custom-tag-wrap">
            <input type="text" class="custom-tag-input" id="newTagName" placeholder="æ–°å¢è‡ªå®šä¹‰åˆ†ç±»æ ‡ç­¾">
            <button class="custom-tag-btn" onclick="addCustomTag()">æ·»åŠ </button>
        </div>
    </div>

    <!-- ä¿ç•™åŸæœ‰æ—¥æœŸåˆ†ç»„ç»“æ„ï¼Œæ–°å¢å®¹å™¨ç¡®ä¿ä½ç½®æ­£ç¡® -->
    <div id="dateGroupsContainer">
        <!-- æ—¥æœŸåˆ†ç»„1 -->
        <div class="date-group">
            <div class="date-title" onclick="toggleDateGroup(this)">
                <span class="date-icon">ğŸ“…</span>
                <span>2026.01.02</span>
                <span class="date-card-count">2å¼ </span>
                <div class="date-right-wrap">
                    <span class="date-toggle-icon">â–¼</span>
                </div>
            </div>
            <div class="date-cards-wrap">
                <div class="card-container">
                    <div class="card-btn-group">
                        <div class="card-edit-btn" onclick="editCard(this)">ç¼–è¾‘</div>
                        <div class="card-delete-btn" onclick="deleteCard(this)">åˆ é™¤</div>
                    </div>
                    <div class="card" data-tag="æ ¸å¿ƒè¯æ±‡">
                        <div class="card-title" onclick="toggleCardContent(this)">
                            <div class="card-title-left">
                                <span class="collect-btn" onclick="toggleCollect(this, event)">â˜†</span>
                                <span class="card-title-text">abandon</span>
                            </div>
                            <span class="card-title-toggle">âˆ’</span>
                        </div>
                        <div class="card-content-wrap">
                            <div class="card-content">
                                <p>1. åŠç‰©åŠ¨è¯ vt. æ”¾å¼ƒï¼›æŠ›å¼ƒï¼ˆç‰›æ´¥æƒå¨é‡Šä¹‰ï¼‰<br>
                                <b>ä¾‹å¥ï¼šHe had to abandon his plan due to the bad weather.</b><br>
                                è¯‘æ–‡ï¼šç”±äºå¤©æ°”æ¶åŠ£ï¼Œä»–ä¸å¾—ä¸æ”¾å¼ƒä»–çš„è®¡åˆ’ã€‚</p>
                                <p>2. åŠç‰©åŠ¨è¯ vt. é—å¼ƒï¼ˆäºº/ç‰©ï¼‰<br>
                                ä¾‹å¥ï¼šThe old man was abandoned by his children.ï¼ˆæ‹“å±•ï¼šabandonçš„è¢«åŠ¨è¯­æ€ç”¨æ³•ï¼‰</p>
                            </div>
                            <span class="card-tag">æ ¸å¿ƒè¯æ±‡</span>
                        </div>
                    </div>
                </div>
                <div class="card-container">
                    <div class="card-btn-group">
                        <div class="card-edit-btn" onclick="editCard(this)">ç¼–è¾‘</div>
                        <div class="card-delete-btn" onclick="deleteCard(this)">åˆ é™¤</div>
                    </div>
                    <div class="card" data-tag="åŸºç¡€å¥å‹">
                        <div class="card-title" onclick="toggleCardContent(this)">
                            <div class="card-title-left">
                                <span class="collect-btn" onclick="toggleCollect(this, event)">â˜†</span>
                                <span class="card-title-text">It is + adj. + that ä»å¥</span>
                            </div>
                            <span class="card-title-toggle">âˆ’</span>
                        </div>
                        <div class="card-content-wrap">
                            <div class="card-content">
                                <p><b>åŸºç¡€ä¾‹å¥ï¼šIt is important that we should practice English every day.</b><br>
                                è¯‘æ–‡ï¼šæˆ‘ä»¬æ¯å¤©ç»ƒä¹ è‹±è¯­æ˜¯å¾ˆé‡è¦çš„ã€‚</p>
                                <p>æ‹“å±•ç”¨æ³•ï¼šIt is + adj. + that ä»å¥ä¸­ï¼Œä»å¥å¸¸ç”¨è™šæ‹Ÿè¯­æ°”ï¼ˆshould+åŠ¨è¯åŸå½¢ï¼‰ï¼Œshouldå¯çœç•¥<br>
                                <b>ä¾‹å¥ï¼šIt is necessary that all students (should) finish the homework on time.</b></p>
                            </div>
                            <span class="card-tag">åŸºç¡€å¥å‹</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ—¥æœŸåˆ†ç»„2 -->
        <div class="date-group">
            <div class="date-title" onclick="toggleDateGroup(this)">
                <span class="date-icon">ğŸ“…</span>
                <span>2026.01.01</span>
                <span class="date-card-count">1å¼ </span>
                <div class="date-right-wrap">
                    <span class="date-toggle-icon">â–¼</span>
                </div>
            </div>
            <div class="date-cards-wrap">
                <div class="card-container">
                    <div class="card-btn-group">
                        <div class="card-edit-btn" onclick="editCard(this)">ç¼–è¾‘</div>
                        <div class="card-delete-btn" onclick="deleteCard(this)">åˆ é™¤</div>
                    </div>
                    <div class="card" data-tag="æ ¸å¿ƒè¯æ±‡">
                        <div class="card-title" onclick="toggleCardContent(this)">
                            <div class="card-title-left">
                                <span class="collect-btn" onclick="toggleCollect(this, event)">â˜†</span>
                                <span class="card-title-text">persist</span>
                            </div>
                            <span class="card-title-toggle">âˆ’</span>
                        </div>
                        <div class="card-content-wrap">
                            <div class="card-content">
                                <p>vi. åšæŒï¼›æŒç»­ï¼ˆpersistå¸¸æ­é…ä»‹è¯ inï¼Œå¤–ç ”ç¤¾æƒå¨é‡Šä¹‰ï¼‰<br>
                                <b>ä¾‹å¥1ï¼šShe persists in learning English despite the difficulties.</b><br>
                                è¯‘æ–‡ï¼šå°½ç®¡å›°éš¾é‡é‡ï¼Œå¥¹ä»åšæŒå­¦ä¹ è‹±è¯­ã€‚<br>
                                <b>ä¾‹å¥2ï¼šThe rain persisted for the whole night.</b><br>
                                è¯‘æ–‡ï¼šé›¨ä¸‹äº†ä¸€æ•´å¤œã€‚</p>
                            </div>
                            <span class="card-tag">æ ¸å¿ƒè¯æ±‡</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="add-card-btn" onclick="openModal('add')">+</button>
    <button class="calendar-btn" onclick="window.location.href='calendar.html'">ğŸ“…</button>

    <!-- ä¿ç•™æ–°å¢/ç¼–è¾‘å…±ç”¨å¼¹çª— -->
    <div class="modal" id="cardModal">
        <div class="modal-content">
            <h3 class="modal-title" id="modalTitle">æ–°å¢è‹±è¯­å­¦ä¹ å¡ç‰‡</h3>
            <input type="hidden" id="editCardId" value="">
            <div class="form-item">
                <label class="form-label">å¡ç‰‡æ ‡é¢˜ï¼ˆè¯æ±‡/å¥å‹/è€ƒç‚¹ï¼‰</label>
                <input type="text" class="form-input" id="cardTitle" placeholder="ä¾‹ï¼šanalyse / ä¸»è°“ä¸€è‡´ ç”¨æ³•">
            </div>
            <div class="form-item">
                <label class="form-label">å¡ç‰‡åˆ†ç±»æ ‡ç­¾</label>
                <select class="form-select" id="cardTag">
                    <option value="æ ¸å¿ƒè¯æ±‡">æ ¸å¿ƒè¯æ±‡</option>
                    <option value="åŸºç¡€å¥å‹">åŸºç¡€å¥å‹</option>
                    <option value="è¯­æ³•è€ƒç‚¹">è¯­æ³•è€ƒç‚¹</option>
                    <option value="å†™ä½œç´ æ">å†™ä½œç´ æ</option>
                </select>
            </div>
            <div class="form-item">
                <label class="form-label">å¡ç‰‡å†…å®¹</label>
                <div class="format-btn-group">
                    <button class="format-btn" onclick="addFormatTag('b')">åŠ ç²—</button>
                    <button class="format-btn" onclick="addFormatTag('br')">æ¢è¡Œ</button>
                    <button class="format-btn" onclick="addFormatTag('blockquote')">å¼•ç”¨</button>
                    <button class="format-btn" onclick="addFormatTag('ul')">æ— åºåˆ—è¡¨</button>
                    <button class="format-btn" onclick="addFormatTag('ol')">æœ‰åºåˆ—è¡¨</button>
                    <button class="format-btn" onclick="addFormatTag('li')">åˆ—è¡¨é¡¹</button>
                </div>
                <textarea class="form-textarea" id="cardContent" placeholder="è¯·è¾“å…¥å¡ç‰‡å†…å®¹ï¼Œæ”¯æŒå¯Œæ–‡æœ¬ç¼–è¾‘"></textarea>
                <p class="form-tips">æ ‡é¢˜åŒ¹é…è‡ªåŠ¨åŠ ç²—å˜çº¢ï½œå·¦æ»‘ç‚¹æŒ‰é’®æ“ä½œï½œé•¿æŒ‰æŸ¥ç³»ç»Ÿè¯å…¸ï½œâ˜†ä¸€é”®æ”¶è—ï½œè‡ªå®šä¹‰æ ‡ç­¾å¯åˆ é™¤</p>
            </div>
            <div class="form-item" id="dateItem" style="display: none;">
                <label class="form-label">æ‰€å±æ—¥æœŸ</label>
                <input type="date" class="form-input" id="cardDate">
            </div>
            <div class="modal-btn-group">
                <button class="modal-btn cancel-btn" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="modal-btn confirm-btn" id="modalConfirmBtn" onclick="submitCard()">ç¡®è®¤æ·»åŠ </button>
            </div>
        </div>
    </div>

    <script>
        let currentEditCard = null;
        // ä¿ç•™ç³»ç»Ÿé»˜è®¤æ ‡ç­¾ï¼ˆä¸å¯åˆ é™¤ï¼‰
        const systemTags = ['å…¨éƒ¨å¡ç‰‡', 'æ ¸å¿ƒè¯æ±‡', 'åŸºç¡€å¥å‹', 'è¯­æ³•è€ƒç‚¹', 'å†™ä½œç´ æ'];
        
        // è·³è½¬åˆ°å¯¹åº”æ—¥æœŸåˆ†ç»„
        function jumpToDateGroup(dateKey) {
            const dateGroups = document.querySelectorAll('.date-group');
            let found = false;
            
            dateGroups.forEach(group => {
                const dateText = group.querySelector('.date-title span:nth-child(2)').textContent.trim();
                if (dateText === dateKey) {
                    found = true;
                    // å±•å¼€è¯¥æ—¥æœŸåˆ†ç»„
                    const cardsWrap = group.querySelector('.date-cards-wrap');
                    const toggleIcon = group.querySelector('.date-toggle-icon');
                    cardsWrap.style.height = cardsWrap.scrollHeight + 'px';
                    toggleIcon.textContent = 'â–¼';
                    
                    // æ»šåŠ¨åˆ°è¯¥æ—¥æœŸåˆ†ç»„
                    group.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
            
            if (!found) {
                alert('æœªæ‰¾åˆ°è¯¥æ—¥æœŸçš„å¡ç‰‡åˆ†ç»„');
            }
        }
        
        // ä¿å­˜å¡ç‰‡æ•°æ®åˆ°localStorage
        function saveCardDataToLocalStorage() {
            const cardData = {};
            
            // éå†æ‰€æœ‰æ—¥æœŸåˆ†ç»„
            document.querySelectorAll('.date-group').forEach(group => {
                const dateText = group.querySelector('.date-title span:nth-child(2)').textContent.trim();
                const cardContainers = group.querySelectorAll('.card-container');
                
                if (cardContainers.length > 0) {
                    const cards = [];
                    cardContainers.forEach(container => {
                        const card = container.querySelector('.card');
                        const title = card.querySelector('.card-title-text').textContent.trim();
                        const content = card.querySelector('.card-content').innerHTML;
                        const tag = card.dataset.tag;
                        
                        cards.push({ title, content, tag });
                    });
                    
                    cardData[dateText] = cards;
                }
            });
            
            localStorage.setItem('cardData', JSON.stringify(cardData));
        }
        
        // é¡µé¢åŠ è½½åˆå§‹åŒ– - ä¿®å¤bugï¼Œä¿ç•™æ‰€æœ‰åˆå§‹åŒ–é€»è¾‘
        window.onload = function() {
            const today = new Date().toISOString().split('T')[0];
            const todayFormat = today.replace(/-/g, '.');
            document.getElementById('cardDate').value = today;
            
            // ä¿®å¤ï¼šä¸¥æ ¼åŒ¹é…æ—¥æœŸï¼Œä¿ç•™è‡ªåŠ¨åˆ›å»ºå½“æ—¥æ—¥æœŸæ åŠŸèƒ½
            let hasTodayGroup = false;
            document.querySelectorAll('.date-title').forEach(title => {
                const dateText = title.querySelector('span:nth-child(2)').textContent.trim();
                if(dateText === todayFormat) {
                    hasTodayGroup = true;
                }
            });
            if(!hasTodayGroup){
                createNewDateGroup(todayFormat);
            }
            
            // ä¿ç•™æ ‡é¢˜åŒ¹é…åŠŸèƒ½
            highlightTitleMatchInAllCards();
            // ä¿ç•™å·¦æ»‘åˆå§‹åŒ–
            initCardSwipe();
            // ä¿ç•™è®¡æ•°æ›´æ–°
            updateAllDateCardCount();
            // ä¿ç•™æ ‡ç­¾åˆ é™¤æŒ‰é’®åˆå§‹åŒ–
            initTagDeleteBtn();
            
            // ä¿®å¤ï¼šåˆå§‹åŒ–æ—¥æœŸæ é«˜åº¦ï¼Œä¿ç•™å±•å¼€çŠ¶æ€
            document.querySelectorAll('.date-cards-wrap').forEach(wrap => {
                setTimeout(() => {
                    wrap.style.height = wrap.scrollHeight + 'px';
                }, 300);
            });

            // ä¿ç•™æ‰€æœ‰å¡ç‰‡é»˜è®¤å±•å¼€åŠŸèƒ½
            document.querySelectorAll('.card-content-wrap').forEach(wrap => {
                wrap.classList.remove('collapse');
                wrap.style.maxHeight = '2000px';
                wrap.style.opacity = '1';
            });
            document.querySelectorAll('.card-title-toggle').forEach(icon => {
                icon.textContent = 'âˆ’';
            });
            
            // åˆå§‹åŒ–å¡ç‰‡ç‚¹å‡»é€‰ä¸­äº‹ä»¶
            initCardSelection();
            
            // æ£€æŸ¥URLå‚æ•°ï¼Œè·³è½¬åˆ°å¯¹åº”æ—¥æœŸ
            const urlParams = new URLSearchParams(window.location.search);
            const targetDate = urlParams.get('date');
            if (targetDate) {
                jumpToDateGroup(targetDate);
            }
            
            // ä¿å­˜åˆå§‹å¡ç‰‡æ•°æ®åˆ°localStorage
            saveCardDataToLocalStorage();
        }
        
        // å¡ç‰‡é€‰ä¸­çŠ¶æ€ç®¡ç†
        function initCardSelection() {
            document.querySelectorAll('.card').forEach(card => {
                card.addEventListener('click', function(e) {
                    // æ’é™¤ç‚¹å‡»æ”¶è—æŒ‰é’®å’Œæ ‡é¢˜æŠ˜å æŒ‰é’®çš„æƒ…å†µ
                    if (!e.target.closest('.collect-btn') && !e.target.closest('.card-title-toggle')) {
                        // ç§»é™¤å…¶ä»–å¡ç‰‡çš„é€‰ä¸­çŠ¶æ€
                        document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
                        // æ·»åŠ å½“å‰å¡ç‰‡çš„é€‰ä¸­çŠ¶æ€
                        this.classList.add('selected');
                    }
                });
            });
        }

        // ä¿ç•™æ ‡é¢˜åŒ¹é…åŠŸèƒ½ - ä»…ä¿®å¤é‡å¤åµŒå¥—bug
        function highlightTitleMatch(card) {
            const contentEl = card.querySelector('.card-content');
            let content = contentEl.innerHTML;
            // ä¿®å¤ï¼šæ¸…é™¤åŸæœ‰åŒ¹é…æ ·å¼ï¼Œé¿å…é‡å¤åµŒå¥—
            content = content.replace(/<span class="title-match">(.*?)<\/span>/gmi, '$1');
            
            const title = card.querySelector('.card-title-text').textContent.trim();
            if (!title) return;
            
            // ä¿ç•™æ­£åˆ™è½¬ä¹‰ï¼Œä¿®å¤ç‰¹æ®Šå­—ç¬¦åŒ¹é…
            const escapedTitle = title.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(`(${escapedTitle})`, 'gmi');
            
            content = content.replace(regex, (match) => `<span class="title-match">${match}</span>`);
            contentEl.innerHTML = content;
        }
        
        // ä¿ç•™æ‰¹é‡æ ‡é¢˜åŒ¹é…
        function highlightTitleMatchInAllCards() {
            const allCards = document.querySelectorAll('.card');
            allCards.forEach(card => {
                highlightTitleMatch(card);
            });
        }

        // ä¿ç•™å·¦æ»‘å¡ç‰‡åŠŸèƒ½ - ä»…ä¿®å¤æ»‘åŠ¨é€»è¾‘bug
        function initCardSwipe() {
            const cardContainers = document.querySelectorAll('.card-container');
            cardContainers.forEach(container => {
                let startX = 0;
                let moveX = 0;
                let isSwiping = false;
                const card = container.querySelector('.card');
                const btnGroupWidth = container.querySelector('.card-btn-group').offsetWidth;

                // ä¿ç•™å¡ç‰‡å¤ä½
                card.style.transform = 'translateX(0)';

                function handleTouchStart(e) {
                    startX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
                    isSwiping = true;
                    e.stopPropagation();
                }
                
                function handleTouchMove(e) {
                    if(!isSwiping) return;
                    const currentX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
                    moveX = currentX - startX;
                    // ä¿ç•™å·¦æ»‘é™åˆ¶
                    if (moveX < 0) { 
                        const translateX = Math.max(moveX, -btnGroupWidth);
                        card.style.transform = `translateX(${translateX}px)`;
                        if(e.type === 'touchmove') e.preventDefault();
                    }
                }
                
                function handleTouchEnd() {
                    if (isSwiping) {
                        // ä¿ç•™æ»‘åŠ¨åˆ¤å®šé€»è¾‘
                        if (moveX < -btnGroupWidth/2) {
                            card.style.transform = `translateX(-${btnGroupWidth}px)`;
                        } else {
                            card.style.transform = 'translateX(0)';
                        }
                    }
                    isSwiping = false;
                    startX = 0;
                    moveX = 0;
                }

                // ä¿ç•™è§¦å±å’Œé¼ æ ‡äº‹ä»¶ç»‘å®š
                container.addEventListener('touchstart', handleTouchStart, {passive: true});
                container.addEventListener('touchmove', handleTouchMove, {passive: false});
                container.addEventListener('touchend', handleTouchEnd);
                container.addEventListener('mousedown', handleTouchStart);
                container.addEventListener('mousemove', handleTouchMove);
                container.addEventListener('mouseup', handleTouchEnd);
                container.addEventListener('mouseleave', handleTouchEnd);
            });
        }

        // ä¿ç•™åˆ é™¤å¡ç‰‡åŠŸèƒ½ - ä»…ä¿®å¤DOMå®šä½bug
        function deleteCard(btn) {
            const btnGroup = btn.parentElement;
            const container = btnGroup.parentElement;
            const card = container.querySelector('.card');
            const dateGroup = container.closest('.date-group');
            
            if (confirm('ç¡®å®šåˆ é™¤è¯¥å¡ç‰‡å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) {
                card.style.transform = 'translateX(0)';
                setTimeout(() => {
                    container.remove();
                    // ä¿ç•™è®¡æ•°æ›´æ–°
                    updateSingleDateCardCount(dateGroup);
                    if (dateGroup.querySelectorAll('.card-container').length === 0) {
                        dateGroup.style.display = 'none';
                    }
                    // ä¿ç•™æœç´¢åŒæ­¥
                    globalFullSearch();
                }, 300);
            } else {
                card.style.transform = 'translateX(0)';
            }
        }

        // ä¿ç•™ç¼–è¾‘å¡ç‰‡åŠŸèƒ½ - æ˜¾ç¤ºHTMLä»£ç ä»¥ä¾¿å¯Œæ–‡æœ¬ç¼–è¾‘
        // HTMLè½¬æ¢ä¸ºå‹å¥½æ ‡è®°
        function htmlToFriendlyMarkdown(html) {
            let text = html;
            
            // è½¬æ¢åŠ ç²— <b>æ–‡æœ¬</b> -> **æ–‡æœ¬**
            text = text.replace(/<b>(.*?)<\/b>/g, '**$1**');
            
            // è½¬æ¢å¼•ç”¨ <blockquote>æ–‡æœ¬</blockquote> -> > æ–‡æœ¬
            text = text.replace(/<blockquote>(.*?)<\/blockquote>/g, '> $1');
            
            // è½¬æ¢æ— åºåˆ—è¡¨ <ul><li>æ–‡æœ¬</li></ul> -> - æ–‡æœ¬
            text = text.replace(/<ul>(.*?)<\/ul>/gs, '$1');
            text = text.replace(/<li>(.*?)<\/li>/g, '- $1');
            
            // è½¬æ¢æœ‰åºåˆ—è¡¨ <ol><li>æ–‡æœ¬</li></ol> -> 1. æ–‡æœ¬
            text = text.replace(/<ol>(.*?)<\/ol>/gs, '$1');
            text = text.replace(/<li>(.*?)<\/li>/g, '1. $1');
            
            // è½¬æ¢æ¢è¡Œ <br> -> \n
            text = text.replace(/<br>/g, '\n');
            
            // ç§»é™¤å…¶ä»–HTMLæ ‡ç­¾
            text = text.replace(/<[^>]*>/g, '');
            
            return text;
        }

        function editCard(btn) {
            const btnGroup = btn.parentElement;
            currentEditCard = btnGroup.parentElement;
            const card = currentEditCard.querySelector('.card');
            
            // è·å–æ•°æ®
            const cardTitle = card.querySelector('.card-title-text').textContent.trim();
            const cardTag = card.dataset.tag;
            const contentEl = card.querySelector('.card-content');
            let cardContent = contentEl.innerHTML;
            cardContent = cardContent.replace(/<span class="title-match">(.*?)<\/span>/gmi, '$1');
            
            // å°†HTMLè½¬æ¢ä¸ºå‹å¥½æ ‡è®°ï¼Œç”¨äºç¼–è¾‘
            const friendlyContent = htmlToFriendlyMarkdown(cardContent);
            
            const dateGroup = currentEditCard.closest('.date-group');
            const cardDateText = dateGroup.querySelector('.date-title span:nth-child(2)').textContent.trim();
            const cardDate = cardDateText.replace(/\./g, '-');

            // å¼¹çª—å¡«å……é€»è¾‘
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘è‹±è¯­å­¦ä¹ å¡ç‰‡';
            document.getElementById('modalConfirmBtn').textContent = 'ç¡®è®¤ä¿®æ”¹';
            document.getElementById('cardTitle').value = cardTitle;
            document.getElementById('cardTag').value = cardTag;
            document.getElementById('cardContent').value = friendlyContent;
            document.getElementById('cardDate').value = cardDate;
            document.getElementById('dateItem').style.display = 'block';
            
            openModal('edit');
            card.style.transform = 'translateX(0)';
        }

        // ä¿ç•™æ ‡ç­¾åˆ é™¤åŠŸèƒ½ - å®Œå…¨ä¿ç•™åŸæœ‰é€»è¾‘
        function initTagDeleteBtn() {
            document.querySelectorAll('.tag-item:not(.system-tag)').forEach(tagItem => {
                addDeleteBtnToTag(tagItem);
            });
        }
        
        function addDeleteBtnToTag(tagItem) {
            if (tagItem.querySelector('.tag-del-btn')) return;
            
            const delBtn = document.createElement('span');
            delBtn.className = 'tag-del-btn';
            delBtn.textContent = 'Ã—';
            delBtn.onclick = function(e) {
                e.stopPropagation();
                deleteTag(this);
            };
            
            tagItem.appendChild(delBtn);
        }
        
        function deleteTag(delBtn) {
            const tagItem = delBtn.parentElement;
            const tagName = tagItem.textContent.replace('Ã—', '').trim();
            
            if (confirm(`ç¡®å®šåˆ é™¤æ ‡ç­¾ã€Œ${tagName}ã€å—ï¼Ÿ`)) {
                const isActive = tagItem.classList.contains('active');
                tagItem.remove();
                
                const select = document.getElementById('cardTag');
                const options = select.querySelectorAll('option');
                options.forEach(option => {
                    if (option.value === tagName) {
                        option.remove();
                    }
                });
                
                if (isActive) {
                    document.querySelector('.tag-item.system-tag[onclick="filterCard(\'all\')"]').click();
                } else {
                    const activeTag = document.querySelector('.tag-item.active').textContent.replace('Ã—', '').trim();
                    filterCard(activeTag === 'å…¨éƒ¨å¡ç‰‡' ? 'all' : activeTag);
                }
                
                updateAllDateCardCount();
                alert(`æ ‡ç­¾ã€Œ${tagName}ã€å·²æˆåŠŸåˆ é™¤ï¼`);
            }
        }

        // ä¿ç•™æ–°å¢è‡ªå®šä¹‰æ ‡ç­¾åŠŸèƒ½ - å®Œå…¨ä¿ç•™åŸæœ‰é€»è¾‘
        function addCustomTag() {
            const newTag = document.getElementById('newTagName').value.trim();
            if (!newTag || Array.from(document.querySelectorAll('.tag-item')).some(item => 
                item.textContent.replace('Ã—', '').trim() === newTag
            )) {
                alert('æ ‡ç­¾ä¸èƒ½ä¸ºç©ºæˆ–å·²å­˜åœ¨ï¼');
                return;
            }
            
            const tagList = document.getElementById('tagList');
            const newTagItem = document.createElement('div');
            newTagItem.className = 'tag-item';
            newTagItem.onclick = () => filterCard(newTag);
            newTagItem.textContent = newTag;
            
            tagList.appendChild(newTagItem);
            addDeleteBtnToTag(newTagItem);
            
            const cardTagSelect = document.getElementById('cardTag');
            const newOption = document.createElement('option');
            newOption.value = newTag;
            newOption.textContent = newTag;
            cardTagSelect.appendChild(newOption);
            
            document.getElementById('newTagName').value = '';
            const activeTag = document.querySelector('.tag-item.active').textContent.replace('Ã—', '').trim();
            filterCard(activeTag === 'å…¨éƒ¨å¡ç‰‡' ? 'all' : activeTag);
            alert(`è‡ªå®šä¹‰æ ‡ç­¾ã€Œ${newTag}ã€æ·»åŠ æˆåŠŸï¼ï¼ˆç‚¹å‡»Ã—å¯åˆ é™¤ï¼‰`);
        }

        // å®Œå…¨ä¿ç•™æ”¶è—åŠŸèƒ½
        function toggleCollect(btn, event) {
            event.stopPropagation();
            const card = btn.closest('.card');
            if(btn.textContent === 'â˜†'){
                btn.textContent = 'â˜…';
                card.classList.add('collect');
            } else {
                btn.textContent = 'â˜†';
                card.classList.remove('collect');
            }
            globalFullSearch();
        }

        // ä¿ç•™å¡ç‰‡æŠ˜å /å±•å¼€ - ä¿®å¤æ˜¾ç¤ºbugï¼Œä¿ç•™äº¤äº’é€»è¾‘
        function toggleCardContent(titleEl) {
            const contentWrap = titleEl.nextElementSibling;
            const toggleIcon = titleEl.querySelector('.card-title-toggle');
            
            if(contentWrap.classList.contains('collapse')){
                contentWrap.classList.remove('collapse');
                toggleIcon.textContent = 'âˆ’';
                contentWrap.style.maxHeight = '2000px';
                contentWrap.style.opacity = '1';
            } else {
                contentWrap.classList.add('collapse');
                toggleIcon.textContent = '+';
                contentWrap.style.maxHeight = '0';
                contentWrap.style.opacity = '0';
            }
            
            // ä¿ç•™é«˜åº¦æ›´æ–°
            const dateCardsWrap = titleEl.closest('.date-cards-wrap');
            setTimeout(() => {
                dateCardsWrap.style.height = dateCardsWrap.scrollHeight + 'px';
            }, 100);
        }

        // å®Œå…¨ä¿ç•™æ—¥æœŸæ è®¡æ•°æ›´æ–°åŠŸèƒ½
        function updateSingleDateCardCount(dateGroup) {
            const cardNum = dateGroup.querySelectorAll('.card-container').length;
            const countDom = dateGroup.querySelector('.date-card-count');
            countDom.textContent = `${cardNum}å¼ `;
            dateGroup.style.display = cardNum === 0 ? 'none' : 'block';
        }
        
        function updateAllDateCardCount() {
            document.querySelectorAll('.date-group').forEach(group => updateSingleDateCardCount(group));
        }

        // ä¿ç•™æ—¥æœŸæ æŠ˜å /å±•å¼€ - ä¿®å¤é«˜åº¦è®¡ç®—bug
        function toggleDateGroup(titleEl) {
            const cardsWrap = titleEl.nextElementSibling;
            const toggleIcon = titleEl.querySelector('.date-toggle-icon');
            
            if (cardsWrap.style.height === '0px' || !cardsWrap.style.height) {
                setTimeout(() => {
                    cardsWrap.style.height = cardsWrap.scrollHeight + 'px';
                }, 100);
                toggleIcon.textContent = 'â–¼';
            } else {
                cardsWrap.style.height = '0px';
                toggleIcon.textContent = 'â–¶';
            }
        }

        // å®Œå…¨ä¿ç•™æ ‡ç­¾ç­›é€‰åŠŸèƒ½
        function filterCard(tag) {
            const allTags = document.querySelectorAll('.tag-item');
            const allContainers = document.querySelectorAll('.card-container');
            
            allTags.forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.tag-item').forEach(item => {
                if(item.textContent.replace('Ã—', '').trim() === (tag === 'all' ? 'å…¨éƒ¨å¡ç‰‡' : tag)) {
                    item.classList.add('active');
                }
            });
            
            allContainers.forEach(container => {
                const card = container.querySelector('.card');
                container.style.display = (tag === 'all' || card.dataset.tag === tag) ? 'block' : 'none';
            });
            
            updateAllDateCardCount();
            document.querySelectorAll('.date-cards-wrap').forEach(wrap => {
                setTimeout(() => {
                    wrap.style.height = wrap.scrollHeight + 'px';
                }, 100);
            });
        }

        // å¢å¼ºå¯Œæ–‡æœ¬ç¼–è¾‘åŠŸèƒ½ - ä½¿ç”¨å‹å¥½æ ‡è®°
        function addFormatTag(tag) {
            const textarea = document.getElementById('cardContent');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            let newText = '';
            
            // ä½¿ç”¨å‹å¥½çš„æ ‡è®°æ–¹å¼ï¼Œè€Œä¸æ˜¯ç›´æ¥æ˜¾ç¤ºHTMLæ ‡ç­¾
            if (tag === 'b') newText = `**${selectedText}**`;
            if (tag === 'br') newText = `\n${selectedText}`;
            if (tag === 'blockquote') newText = `> ${selectedText}`;
            if (tag === 'ul') newText = `- ${selectedText}`;
            if (tag === 'ol') newText = `1. ${selectedText}`;
            if (tag === 'li') newText = `- ${selectedText}`;
            if (tag === 'p') newText = `${selectedText}\n`;
            
            textarea.value = textarea.value.substring(0, start) + newText + textarea.value.substring(end);
            textarea.focus();
        }

        // ä¿ç•™å…¨å±€æœç´¢åŠŸèƒ½ - ä¿®å¤æ”¶è—æœç´¢bug
        function globalFullSearch() {
            const keyword = document.getElementById('globalSearch').value.toLowerCase().trim();
            const allContainers = document.querySelectorAll('.card-container');
            const activeTag = document.querySelector('.tag-item.active').textContent.replace('Ã—', '').trim();
            const filterTag = activeTag === 'å…¨éƒ¨å¡ç‰‡' ? 'all' : activeTag;

            if (!keyword) {
                allContainers.forEach(container => {
                    const card = container.querySelector('.card');
                    container.style.display = (filterTag === 'all' || card.dataset.tag === filterTag) ? 'block' : 'none';
                });
                updateAllDateCardCount();
                document.querySelectorAll('.date-cards-wrap').forEach(wrap => {
                    setTimeout(() => {
                        wrap.style.height = wrap.scrollHeight + 'px';
                    }, 100);
                });
                return;
            }
            
            allContainers.forEach(container => {
                const card = container.querySelector('.card');
                const cardTitle = card.querySelector('.card-title-text').textContent.toLowerCase();
                const contentHtml = card.querySelector('.card-content').innerHTML;
                const cardContent = contentHtml.replace(/<[^>]*>/g, '').toLowerCase();
                const isCollected = card.classList.contains('collect');
                const tagMatch = filterTag === 'all' || card.dataset.tag === filterTag;
                const textMatch = cardTitle.includes(keyword) || cardContent.includes(keyword);
                
                container.style.display = (keyword === 'æ”¶è—' && isCollected && tagMatch) || (textMatch && tagMatch) ? 'block' : 'none';
            });
            
            updateAllDateCardCount();
            document.querySelectorAll('.date-cards-wrap').forEach(wrap => {
                setTimeout(() => {
                    wrap.style.height = wrap.scrollHeight + 'px';
                }, 100);
            });
        }

        // ä¿ç•™å¼¹çª—å¼€å…³ - ä¿®å¤åŠ¨ç”»bugï¼Œä¿ç•™é€»è¾‘
        function openModal(type) {
            const modal = document.getElementById('cardModal');
            if (type === 'edit') {
                document.getElementById('modalTitle').textContent = 'ç¼–è¾‘è‹±è¯­å­¦ä¹ å¡ç‰‡';
                document.getElementById('modalConfirmBtn').textContent = 'ç¡®è®¤ä¿®æ”¹';
                document.getElementById('dateItem').style.display = 'block';
            } else {
                document.getElementById('modalTitle').textContent = 'æ–°å¢è‹±è¯­å­¦ä¹ å¡ç‰‡';
                document.getElementById('modalConfirmBtn').textContent = 'ç¡®è®¤æ·»åŠ ';
                document.getElementById('dateItem').style.display = 'none';
                document.getElementById('cardTitle').value = '';
                document.getElementById('cardContent').value = '';
                document.getElementById('cardTag').value = 'æ ¸å¿ƒè¯æ±‡';
                currentEditCard = null;
            }
            
            modal.style.display = 'flex';
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
        }
        
        function closeModal() {
            const modal = document.getElementById('cardModal');
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
                if(!currentEditCard) {
                    document.getElementById('cardTitle').value = '';
                    document.getElementById('cardContent').value = '';
                }
            }, 300);
        }

        // å‹å¥½æ ‡è®°è½¬æ¢ä¸ºHTML
        function friendlyMarkdownToHtml(text) {
            let html = text;
            
            // è½¬æ¢åŠ ç²— **æ–‡æœ¬** -> <b>æ–‡æœ¬</b>
            html = html.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
            
            // è½¬æ¢å¼•ç”¨ > æ–‡æœ¬ -> <blockquote>æ–‡æœ¬</blockquote>
            html = html.replace(/^(> )(.*)$/gm, '<blockquote>$2</blockquote>');
            
            // è½¬æ¢æ— åºåˆ—è¡¨ - æ–‡æœ¬ -> <ul><li>æ–‡æœ¬</li></ul>
            // æ³¨æ„ï¼šè¿™æ˜¯ç®€åŒ–å¤„ç†ï¼Œå®é™…åº”ç”¨å¯èƒ½éœ€è¦æ›´å¤æ‚çš„é€»è¾‘
            html = html.replace(/^(- )(.*)$/gm, '<li>$2</li>');
            if (html.includes('<li>')) {
                html = `<ul>${html}</ul>`;
            }
            
            // è½¬æ¢æœ‰åºåˆ—è¡¨ 1. æ–‡æœ¬ -> <ol><li>æ–‡æœ¬</li></ol>
            // æ³¨æ„ï¼šè¿™æ˜¯ç®€åŒ–å¤„ç†ï¼Œå®é™…åº”ç”¨å¯èƒ½éœ€è¦æ›´å¤æ‚çš„é€»è¾‘
            html = html.replace(/^(1\. )(.*)$/gm, '<li>$2</li>');
            if (html.includes('<ol>') && html.includes('<li>')) {
                html = html.replace('<ul>', '<ol>');
                html = html.replace('</ul>', '</ol>');
            }
            
            // è½¬æ¢æ¢è¡Œ
            html = html.replace(/\n/g, '<br>');
            
            return html;
        }

        // ä¿ç•™æäº¤å¡ç‰‡åŠŸèƒ½ - ä¿®æ”¹ä¸ºå‹å¥½æ ‡è®°è½¬HTML
        function submitCard() {
            const title = document.getElementById('cardTitle').value.trim();
            const tag = document.getElementById('cardTag').value;
            const content = document.getElementById('cardContent').value.trim();
            const dateVal = currentEditCard ? document.getElementById('cardDate').value : new Date().toISOString().split('T')[0];
            const dateFormat = dateVal.replace(/-/g, '.');

            if (!title || !content) { 
                alert('å¡ç‰‡æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©ºï¼'); 
                return; 
            }

            // å°†å‹å¥½æ ‡è®°è½¬æ¢ä¸ºHTMLæ ¼å¼
            let htmlContent = friendlyMarkdownToHtml(content);

            // ç¼–è¾‘å¡ç‰‡
            if (currentEditCard) {
                const oldDateGroup = currentEditCard.closest('.date-group');
                const card = currentEditCard.querySelector('.card');
                
                card.querySelector('.card-title-text').textContent = title;
                card.dataset.tag = tag;
                card.querySelector('.card-content').innerHTML = htmlContent;
                card.querySelector('.card-tag').textContent = tag;
                
                setTimeout(() => {
                    highlightTitleMatch(card);
                }, 200);
                
                let newDateGroup = null;
                document.querySelectorAll('.date-group').forEach(group => {
                    const dateText = group.querySelector('.date-title span:nth-child(2)').textContent.trim();
                    if(dateText === dateFormat) {
                        newDateGroup = group;
                    }
                });
                
                if(oldDateGroup.querySelector('.date-title span:nth-child(2)').textContent.trim() !== dateFormat) {
                    oldDateGroup.querySelector('.date-cards-wrap').removeChild(currentEditCard);
                    if(newDateGroup) {
                        newDateGroup.querySelector('.date-cards-wrap').appendChild(currentEditCard);
                    } else {
                        newDateGroup = createNewDateGroup(dateFormat, currentEditCard);
                    }
                    updateSingleDateCardCount(oldDateGroup);
                }
                
                setTimeout(() => {
                    currentEditCard.closest('.date-cards-wrap').style.height = currentEditCard.closest('.date-cards-wrap').scrollHeight + 'px';
                }, 100);
                
                updateSingleDateCardCount(currentEditCard.closest('.date-group'));
                alert('å¡ç‰‡ä¿®æ”¹æˆåŠŸï¼');
            } 
            // æ–°å¢å¡ç‰‡
            else {
                let dateGroup = null;
                document.querySelectorAll('.date-group').forEach(group => {
                    const dateText = group.querySelector('.date-title span:nth-child(2)').textContent.trim();
                    if(dateText === dateFormat) {
                        dateGroup = group;
                    }
                });
                
                if (!dateGroup) { 
                    dateGroup = createNewDateGroup(dateFormat); 
                }
                
                const newCardContainer = createNewCard(title, tag, htmlContent);
                dateGroup.querySelector('.date-cards-wrap').appendChild(newCardContainer);
                
                const newCard = newCardContainer.querySelector('.card');
                setTimeout(() => {
                    highlightTitleMatch(newCard);
                }, 200);
                
                initCardSwipe();
                
                setTimeout(() => {
                    dateGroup.querySelector('.date-cards-wrap').style.height = dateGroup.querySelector('.date-cards-wrap').scrollHeight + 'px';
                }, 100);
                
                updateSingleDateCardCount(dateGroup);
                alert('å¡ç‰‡æ·»åŠ æˆåŠŸï¼');
            }
            
            closeModal();
            globalFullSearch();
            
            // ä¿å­˜å¡ç‰‡æ•°æ®åˆ°localStorage
            saveCardDataToLocalStorage();
        }

        // ä¿ç•™åˆ›å»ºæ–°æ—¥æœŸç»„ - ä¿®å¤æ’å…¥ä½ç½®bug
        function createNewDateGroup(dateFormat, cardContainer) {
            const newDateGroup = document.createElement('div');
            newDateGroup.className = 'date-group';
            newDateGroup.innerHTML = `
                <div class="date-title" onclick="toggleDateGroup(this)">
                    <span class="date-icon">ğŸ“…</span>
                    <span>${dateFormat}</span>
                    <span class="date-card-count">0å¼ </span>
                    <div class="date-right-wrap">
                        <span class="date-toggle-icon">â–¼</span>
                    </div>
                </div>
                <div class="date-cards-wrap" style="height: auto"></div>
            `;
            
            // ä¿®å¤æ’å…¥ä½ç½®ï¼Œä¿ç•™åˆ›å»ºé€»è¾‘
            const dateGroupsContainer = document.getElementById('dateGroupsContainer');
            dateGroupsContainer.appendChild(newDateGroup);
            
            if(cardContainer) {
                newDateGroup.querySelector('.date-cards-wrap').appendChild(cardContainer);
            }
            
            const wrap = newDateGroup.querySelector('.date-cards-wrap');
            setTimeout(() => {
                wrap.style.height = wrap.scrollHeight + 'px';
            }, 300);
            
            return newDateGroup;
        }

        // ä¿ç•™åˆ›å»ºæ–°å¡ç‰‡ - ä¿®å¤å±•å¼€çŠ¶æ€
        function createNewCard(title, tag, content) {
            const container = document.createElement('div');
            container.className = 'card-container';
            container.innerHTML = `
                <div class="card-btn-group">
                    <div class="card-edit-btn" onclick="editCard(this)">ç¼–è¾‘</div>
                    <div class="card-delete-btn" onclick="deleteCard(this)">åˆ é™¤</div>
                </div>
                <div class="card" data-tag="${tag}">
                    <div class="card-title" onclick="toggleCardContent(this)">
                        <div class="card-title-left">
                            <span class="collect-btn" onclick="toggleCollect(this, event)">â˜†</span>
                            <span class="card-title-text">${title}</span>
                        </div>
                        <span class="card-title-toggle">âˆ’</span>
                    </div>
                    <div class="card-content-wrap" style="max-height: 2000px; opacity: 1;">
                        <div class="card-content"></div>
                        <span class="card-tag">${tag}</span>
                    </div>
                </div>
            `;
            
            // å•ç‹¬è®¾ç½®å¡ç‰‡å†…å®¹ï¼Œç¡®ä¿HTMLæ ‡ç­¾è¢«æ­£ç¡®æ¸²æŸ“
            container.querySelector('.card-content').innerHTML = content;
            
            return container;
        }
        
        // ä¿ç•™ç‚¹å‡»å¤–éƒ¨å…³é—­å¼¹çª—
        document.getElementById('cardModal').addEventListener('click', function(e) {
            if(e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>
